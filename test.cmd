@echo off
setlocal

set TEST_GAME_NAME=my game

echo Creating project directory...
for %%a in (lib32 lib64 licenses) do mkdir "%TEST_GAME_NAME%\data\%%a"
for %%a in (acsetup.cfg ags32 ags64 audio.vox "%TEST_GAME_NAME%.ags") do (
    >"%TEST_GAME_NAME%\data\%%a" echo %%a
)
for %%a in (modules.lst libtest.so libtest.so.1 libtest.so.1.2 libtest.so.1.2.3) do (
    >"%TEST_GAME_NAME%\data\lib32\%%a" echo %%a
    >"%TEST_GAME_NAME%\data\lib64\%%a" echo %%a
)
>"%TEST_GAME_NAME%\data\licenses\ags-copyright" echo ags-copyright
>"%TEST_GAME_NAME%\%TEST_GAME_NAME%" echo %TEST_GAME_NAME%

echo Creating archive...
call "%~dp0ags-tar.cmd" "%TEST_GAME_NAME%\%TEST_GAME_NAME%"

echo Writing expected result...
REM Encode with:
REM   tar -cf expected.mtree --format mtree --options mtree:!all,mode @"my game.tar.gz"
REM   certutil -encodehex -f expected.mtree expected.hex 12
>expected.hex echo 236d747265650a2e2f6d795c30343067616d65206d6f64653d3735350a2e2f64617461206d6f64653d3735350a2e2f646174612f616373657475702e636667206d6f64653d3634340a2e2f646174612f6167733332206d6f64653d3735350a2e2f646174612f6167733634206d6f64653d3735350a2e2f646174612f617564696f2e766f78206d6f64653d3634340a2e2f646174612f6d795c30343067616d652e616773206d6f64653d3634340a2e2f646174612f6c69623332206d6f64653d3735350a2e2f646174612f6c696233322f6c6962746573742e736f206d6f64653d3634340a2e2f646174612f6c696233322f6c6962746573742e736f2e31206d6f64653d3634340a2e2f646174612f6c696233322f6c6962746573742e736f2e312e32206d6f64653d3634340a2e2f646174612f6c696233322f6c6962746573742e736f2e312e322e33206d6f64653d3634340a2e2f646174612f6c696233322f6d6f64756c65732e6c7374206d6f64653d3634340a2e2f646174612f6c69623634206d6f64653d3735350a2e2f646174612f6c696236342f6c6962746573742e736f206d6f64653d3634340a2e2f646174612f6c696236342f6c6962746573742e736f2e31206d6f64653d3634340a2e2f646174612f6c696236342f6c6962746573742e736f2e312e32206d6f64653d3634340a2e2f646174612f6c696236342f6c6962746573742e736f2e312e322e33206d6f64653d3634340a2e2f646174612f6c696236342f6d6f64756c65732e6c7374206d6f64653d3634340a2e2f646174612f6c6963656e736573206d6f64653d3735350a2e2f646174612f6c6963656e7365732f6167732d636f70797269676874206d6f64653d3634340a
certutil -decodehex -f expected.hex expected.mtree

echo Writing actual result...
tar -cf actual.mtree --format mtree --options mtree:!all,mode @"%TEST_GAME_NAME%.tar.gz"

echo Comparing result...
endlocal
fc /l actual.mtree expected.mtree
